
"use strict";app.controller("Customers.IndexCtrl",["$scope","toaster","$http","$aside","$timeout","SweetAlert","FileUploader",function(i,f,g,b,c,d,j){i.uploader=new j({url:"/customers/uploadcsv.json",alias:"csv"});console.log(i.uploader);i.sw=d;i.cstData={};i.master={};i.isSendingData=false;i.isLoading=true;i.sort={col:"name",odr:"asc"};i.pager={totalRec:78,step:10,currentPg:1,totalPg:8};i.customersData=[];i.srchkey="";i.searchNow=function(){console.log(i.srchkey);i.isLoading=true;g.post("/customers/srchkey.json?page="+i.pager.currentPg+"&limit="+i.pager.step+"&sort="+i.sort.col+"&direction="+i.sort.odr,{keyword:i.srchkey}).success(function(k){i.customersData=k.customers;i.pager=k.pager;i.pager.totalPages=[];i.isLoading=false;for(var a=1;a<=k.pager.totalPg;a++){i.pager.totalPages.push({vl:a})}})};i.getDataCall=function(){i.isLoading=true;g.get("/customers.json?page="+i.pager.currentPg+"&limit="+i.pager.step+"&sort="+i.sort.col+"&direction="+i.sort.odr).success(function(k){i.customersData=k.customers;i.pager=k.pager;i.pager.totalPages=[];i.isLoading=false;for(var a=1;a<=k.pager.totalPg;a++){i.pager.totalPages.push({vl:a})}})};i.getData=function(){if(i.srchkey==""){i.getDataCall()}else{i.searchNow()}};i.searchNowBtn=function(){i.sort={col:"name",odr:"asc"};i.pager={totalRec:78,step:10,currentPg:1,totalPg:8};i.searchNow()};i.sortBy=function(a){console.log(i.sort);console.log(a);if(a==i.sort.col&&i.sort.odr=="asc"){i.sort.odr="desc"}else{i.sort.col=a;i.sort.odr="asc"}i.getData()};i.editCst=function(a){i.cstData=a};i.removeCst=function(a){var k=a.id;i.sw.swal({title:"Are you sure?",text:"You will not be able to recover this customers data!",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:false},function(l){if(!l){return false}g.post("/customers/delete/"+k+".json").success(function(m){i.getData();i.sw.swal("Deleted!","Your customer has been deleted.","success")})})};i.changePg=function(a){i.pager.currentPg=a;i.getData()};i.setLimit=function(a){i.pager.currentPg=1;i.pager.step=a;i.getData()};i.form={reset:function(a){i.cstData=angular.copy(i.master);a.$setPristine(true)},submit:function(k){var a=null;if(k.$invalid){var l=null,a=null;for(l in k){if(l[0]!="$"){if(a===null&&!k[l].$valid){a=k[l].$name}if(k[l].$pristine){k[l].$dirty=true}}}angular.element(".ng-invalid[name="+a+"]").focus();d.error("Please verify once again","The form cannot be submitted because it contains errors, Errors are marked with a red.","error");return}else{i.isSendingData=true;g.post("/customers/add-or-update.json",i.cstData).success(function(m){console.log(i.cstData);if(m.result.error==0){d.success("Success!",m.result.msg,"success");i.getData();i.cstData=angular.copy(i.master);k.$setPristine(true)}else{d.error("Error!",m.result.msg,"error")}i.isSendingData=false}).error(function(m){d.error("Some Network Issue!","Please try once again...","error");i.isSendingData=false})}}};i.getData();jQuery.datetimepicker.setLocale("en");var h=new Date();var e=jQuery(".dtime").datepicker({maxDate:0,format:"MM/dd/YYYY"})}]);